// Подключаем библиотеки для работы с файлами и строками
#include <iostream>
#include <fstream>
#include <string>

// Определяем константу для количества строк по умолчанию
#define DEFAULT_LINES 10

// Определяем функцию, которая печатает конец файла или с указанной строки
void print_tail(std::string filename, int start_line) 
{
    // Открываем файл для чтения
    std::ifstream file(filename);
    // Проверяем, что файл успешно открыт
    if (file.is_open()) 
    {
        // Создаем переменную для хранения текущей строки
        std::string line;
        // Создаем переменную для хранения номера текущей строки
        int line_number = 0;
        // Создаем переменную для хранения общего количества строк в файле
        int total_lines = 0;
        // Перебираем все строки в файле, чтобы подсчитать их количество
        while (std::getline(file, line)) 
        {
            // Увеличиваем общее количество строк на единицу
            ++total_lines;
        }
        // Перемещаем указатель файла в начало
        file.clear();
        file.seekg(0);
        // Перебираем все строки в файле снова
        // если параметры не передавались, то
        if (start_line == DEFAULT_LINES)
        {
            while (std::getline(file, line)) 
            {
                // Увеличиваем номер строки на единицу
                ++line_number;
                // Проверяем, что номер строки больше или равен общему количеству строк минус start_line
                if (line_number >= total_lines - start_line + 1) { // Изменили условие
                    // Выводим строку на экран
                    std::cout << line << std::endl;
                }
            }
        }
        // если передавался параметр, с какой строки печатать то
        else
        {
            while (std::getline(file, line)) 
            {
                // Увеличиваем номер строки на единицу
                ++line_number;
                // выводим с той строки, которую указал пользователь
                if (line_number >= start_line)
                {
                    // Выводим строку на экран
                    std::cout << line << std::endl;
                }
            }
        }
        // Закрываем файл
        file.close();
    }
    else 
    {
        // Выводим сообщение об ошибке, если файл не удалось открыть
        std::cerr << "Не удалось открыть файл " << filename << std::endl;
    }
}

// Определяем главную функцию программы
int main(int argc, char* argv[]) 
{
    setlocale(LC_ALL, "ru");
    // Проверяем, что количество аргументов командной строки больше одного
    if (argc > 1) 
    {
        // Получаем имя файла из первого аргумента
        std::string filename = argv[1];
        // Создаем переменную для хранения номера строки, от которой печатать до конца
        int start_line;
        // Проверяем, есть ли второй параметр командной строки
        if (argc > 2) 
        { // Добавили условный оператор if-else
            // Присваиваем переменной start_line значение второго параметра командной строки, преобразованного в целое число
            start_line = std::stoi(argv[2]);
            // Проверяем, что start_line положительный
            if (start_line <= 0) 
            {
                // Выводим сообщение об ошибке, если start_line отрицательный или нулевой
                std::cerr << "Номер строки должен быть положительным" << std::endl;
                // Завершаем программу с кодом ошибки 1
                return 1;
            }
        }
        else 
        {
            // Присваиваем переменной start_line значение константы DEFAULT_LINES
            start_line = DEFAULT_LINES;
        }
        // Вызываем функцию print_tail с заданными параметрами
        print_tail(filename, start_line);
    }
    else 
    {
        // Выводим сообщение об ошибке и подсказку, если количество аргументов командной строки меньше или равно одному
        std::cerr << "Недостаточно параметров"                          << std::endl;
        std::cerr << "Использование: tail <имя файла> [номер строки]"   << std::endl;
        // Завершаем программу с кодом ошибки 1
        return 1;
    }
    // Завершаем программу с кодом успеха 0
    return 0;
}